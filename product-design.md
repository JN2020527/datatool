# 数据字典小工具产品功能设计

## 1. 产品概述

### 1.1 产品定位
**核心价值**：让团队在3分钟内完成字段命名规范，1分钟内找到已有字段并了解其使用情况

**目标用户**：内部10人开发团队
- **数据架构师**：负责命名规范制定和维护
- **开发工程师**：日常使用字段命名和查询  
- **项目经理**：查看模型结构和导出文档

**使用场景**：数据模型设计、字段命名规范、模型结构管理

### 1.2 解决的核心问题
- **字段命名不规范**：缺乏统一的命名规则和标准
- **重复命名问题**：相同含义的字段使用不同命名
- **查询困难**：无法快速找到已有字段或了解字段使用情况
- **血缘关系混乱**：字段被哪些模型引用不清晰

## 2. 核心功能架构

### 2.1 三大核心模块

#### 模块1：词根管理（Rule Center）
**核心目标**：建立和维护团队统一的命名规则和标准

**主要功能**：
- 词根新增、编辑、删除
- 启用/停用词根（控制可被字段引用）
- 词根合并与去重（处理同义、别名）
- 批量导入/导出词根（CSV/Excel）
- 唯一性校验与冲突提示（snake_case，禁用重复/非法字符）
- 使用频率统计与影响面查看（被哪些字段/模型引用）
- 操作记录（创建/修改/停用/合并）

#### 模块2：字段管理（Field Registry）
**核心目标**：管理所有字段的生命周期和基本信息

**主要功能**：
- 字段创建和信息管理
- 全局检索和查询
- 字段状态管理（已创建/使用中/已弃用）
- 智能命名生成（词根组合、冲突检测、自动后缀）
- 批量处理和词根扩展

#### 模块3：模型管理（Model Manager）
**核心目标**：管理模型结构，自动记录字段血缘关系

**主要功能**：
- 模型创建和字段配置
- 模型查询和血缘分析
- SQL导出和结构文档导出

### 2.2 功能模块关系
```
词根管理 → 提供命名规范库和词根库
    ↓
字段管理 → 基于词根构建字段，包含智能命名生成
    ↓
模型管理 → 基于字段构建模型，自动记录血缘关系
```

## 3. 详细功能设计

### 3.1 词根管理（Rule Center）

#### 3.1.1 词根基础操作
- 新增词根：
  - 输入规范名：
    - 原子词根：小写英文，单词形式（不含下划线），示例：cust、order、amount
    - 词根短语（可选，仅高频复用场景）：snake_case 组合，示例：grp_cust、order_amount
  - 校验与转换：
    - 任意输入自动转换为小写
    - 原子词根：^[a-z]+$；词根短语：^[a-z]+(_[a-z]+)*$
    - 禁用连续/首尾下划线，长度≤64
  - 附加信息：含义、示例、标签
- 编辑词根：支持重命名（自动级联更新引用预检查）
  - **级联更新机制**：重命名词根时，自动更新所有引用该词根的字段名
  - **预检查流程**：
    1. 扫描影响范围：找出所有引用该词根的字段和模型
    2. 显示预览：告知用户影响的具体字段和模型数量
    3. 冲突检测：检查重命名后是否会产生新的命名冲突
    4. 确认操作：用户确认后才执行实际的重命名
  - **示例场景**：重命名 `cust` → `customer` 时，自动更新：
    - `cust_id` → `customer_id`
    - `cust_name` → `customer_name`  
    - `cust_register_ts` → `customer_register_ts`
  - **优势**：保证数据一致性，减少手动操作，降低错误风险
- 删除词根：仅当无引用或经确认迁移完成
- 启用/停用：停用后不可被新字段引用，保留历史

#### 3.1.2 词根质量与治理
- 冲突优先级：命名非法 > 词根冲突（含别名）
- 冲突处理：同名时阻断创建/重命名，提供“使用主词根/设为别名/去合并页面”的指引
- 别名映射（P0）：同义词标记为主词根别名，生成与搜索统一指向主词根
- 命名转换：支持任意输入风格自动转为snake_case

#### 3.1.3 批量与分类
- 批量导入/导出：CSV/Excel模板
- 分类与标签：按业务域/技术类型组织
- 搜索与过滤：名称、标签、状态、多条件筛选

#### 3.1.4 影响面与审计
- 使用频率统计：按字段/模型维度统计被引用次数
- 影响面分析：变更前预估受影响字段/模型
- 操作记录：创建/修改/停用/合并的操作日志

说明：默认使用snake_case 作为团队统一标准。

### 3.2 字段管理（Field Registry）

#### 3.2.1 字段管理功能
**字段创建流程**

1. 输入业务描述或选择业务域
2. 系统基于词根库生成推荐组合和字段名预览
3. 若无推荐或词根缺失：打开词根创建弹窗，完成新增后自动返回
4. 选择/微调词根组合与模板参数（技术词根、单位/限定）
5. 实时冲突校验通过（字段名唯一、规范合法）
6. 一键创建（仅允许基于词根组合创建，禁止手工输入任意字段名）

约束：所有字段必须基于词根组合创建，禁止绕过词根库直接命名。

**字段查询功能**
- 模糊搜索：支持字段名、业务含义、创建人搜索
- 精确搜索：按具体条件精确匹配
- 分类筛选：按数据类型、状态（使用中/已弃用）等筛选
- 结果排序和分页
- **新增**：搜索结果按使用频率排序，一键复制字段名到剪贴板

**标准数据类型校验（内置枚举）**
- 数据类型采用固定枚举（如 INT、VARCHAR、DATETIME、DECIMAL 等）
- 创建/编辑字段时进行类型校验，不提供自定义类型配置

**重复性管理**
- 字段名严格唯一，不允许重复
- 所有字段都基于词根库组合生成，确保命名一致性
- 创建时自动检查字段名是否已存在
- 发现重复时阻止创建，提示用户选择其他命名

**变更历史记录**
- 记录字段的创建、重命名、弃用等关键操作

**冲突与一致性策略（字段）**
- 校验顺序与阻断：命名非法 > 词根冲突 > 字段冲突；遇高优先级错误即阻断
- 归一化口径：全部转小写、去首尾空白、折叠连续下划线、全角转半角后再校验
- 等价判断：基于规范化标准形进行查重与搜索匹配
- 冲突提示：展示冲突对象与推荐替代项（如追加单位/限定/_v2），支持一键替换

#### 3.2.2 生命周期管理
**状态管理**
```
已创建 → 使用中 → 已弃用
   ↓        ↓        ↓
 创建完成   正常使用   停止使用
```

**引用关系维护**
- 引用关系自动记录（通过模型管理功能）
- 引用变更历史记录（自动生成）
- 字段血缘关系列表展示（简单表格形式）

**状态变更管理**
- 字段创建后默认为"使用中"状态
- 确认不再使用时可标记为"已弃用"
- 已弃用字段仍可查看，但不可被新模型引用

#### 3.2.3 智能命名生成

**词根组合机制**

- 基于词根库智能组合生成字段名
- 命名模板：业务词根_技术词根_单位/限定（默认无前缀；如确有消歧需要，可启用域前缀）


**自动命名生成**

- 分析业务描述，从词根库中匹配相应词根
- 按模板自动拼接字段名
- 实时冲突检测
- 自动后缀生成（_2、_3等）

#### 3.2.4 词根扩展机制
**触发条件与流程衔接**：检测到无推荐或词根缺失时，触发词根创建引导（参见3.2.1 第3步），完成后返回继续字段创建。

**核心策略**
当命名规范库没有对应词根支持时，引导用户创建新词根：

1. **模糊匹配阶段**
   - 使用编辑距离算法计算词根相似度
   - 找到最相似的现有词根作为替代
   - 例如：输入"register"时，推荐"signup"或"sign_up"

2. **词根推荐阶段**
   - 基于语义分析推荐最接近的词根组合
   - 分析用户输入的业务含义，智能推荐词根
   - 提供多个命名选项供用户选择

3. **词根扩展阶段**
   - 新词根直接添加到公共词根库
   - 提供词根使用频率统计，帮助识别常用词根
   - 通过用户使用不断自我完善词根库

#### 3.2.5 批量处理功能
**文本批量输入**
- 支持文本批量输入（每行一个字段描述）
- 实时预览生成的命名结果
- 支持批量修改和确认
- 结果导出为Excel

### 3.4 模型管理（Model Manager）

#### 3.4.1 模型创建功能
**基本信息管理**
- 模型名称、描述、类型设置
- 模型标签管理（可选）
- 模型状态管理（已创建/已弃用）

**字段配置管理**
- 从字段库选择字段构成模型
- 设置字段顺序、是否必填、默认值
- 字段属性配置（长度、精度、约束等）
- 模型字段验证和完整性检查

#### 3.4.2 模型查询功能
**模型检索**
- 按名称、字段等条件搜索
- 模型结构展示和字段列表

**变更历史记录**
- 记录模型的创建、字段变更、状态变更等关键信息

**血缘分析**
- 自动记录字段被哪些模型引用（无需手动维护）
- 字段血缘关系列表展示（简单表格形式）
- 模型间依赖关系分析
- 引用关系变更实时同步

#### 3.4.3 模型导出功能
**SQL导出**
- 生成标准建表语句
- 支持MySQL、Oracle两种主流数据库
- 基础字段定义，无复杂索引约束

**结构文档导出**
- 导出模型结构为Excel格式
- 包含字段名、类型、描述、是否必填等基本信息
- 支持批量导出多个模型



## 4. 功能优先级规划（重新规划）

### 4.1 P0优先级（MVP核心功能）
**核心功能**
- ✅ 词根管理：建立基本的命名规范体系
- ✅ 字段管理：字段创建、查询、智能命名生成、重复性检查
- ✅ 字段快速检索（支持模糊搜索，按使用频率排序）

**理由**：MVP应该专注于解决最核心的痛点，避免功能过载

### 4.2 P1优先级（重要功能）
**增强功能**
- ⚠️ 模型创建和管理：支持模型结构管理
- ⚠️ 血缘关系维护：通过模型管理自动记录
- ⚠️ 批量处理：提高批量操作效率

### 4.3 P2优先级（锦上添花）
**优化功能**
- 版本控制：支持规范变更管理
- 词根扩展机制：处理词根缺失情况
- 个人收藏夹：提升个人使用体验
- 操作日志：支持操作审计

## 5. 技术实现方案

### 5.1 技术架构
**整体架构**：轻量级Web应用，前后端分离
**数据存储**：开发阶段SQLite，生产环境PostgreSQL
**开发周期**：2-3周
**团队规模**：1-2名开发者
**时间分配**：前端0.5周，后端1周，联调测试0.5周

### 5.2 数据设计要点
**核心数据表**
- 词根管理表：存储命名规则和词根
- 字段管理表：存储字段基本信息
- 模型管理表：存储模型结构和字段关系
- 血缘关系表：自动记录字段引用关系

**设计原则**
- 扁平化结构，避免复杂分层
- 使用固定标准数据类型
- 简化操作日志，专注核心变更
- 适合小团队快速上线的轻量级架构

**数据模型详表（建议最小集合）**
- 公共字段：id（主键）、normalized_name（规范化名，用于唯一索引）、status（active/deprecated）、created_at、updated_at
- 词根表：name（唯一）、aliases、tags、usage_count、remark
- 字段表：field_name（唯一）、meaning、data_type（受控枚举）、root_list、remark
- 模型表：model_name、description、remark；模型-字段关联表：model_id、field_id、pos、required、default
- 血缘表：field_id、model_id、created_at（记录引用关系）
- 索引与约束：对 normalized_name 建唯一索引；按查询高频字段建立索引；词根名/字段名全局唯一

**ID/删除策略**
- ID：开发环境用自增ID；如需跨环境或并发，考虑UUID
- 删除：不做软删除，保留status枚举表示生命周期


### 5.3 技术栈推荐

#### 5.3.1 前端技术栈
- **Vue.js 3**：轻量级、易上手、生态丰富
- **Vue Admin Template**：基于Vue 3 + Element Plus的现成管理后台模板
- **Element Plus**：成熟的UI组件库，提供丰富的组件支持
- **Vite**：快速的构建工具，开发体验好

**选择理由**：开箱即用，快速搭建基础框架，专注业务开发

#### 5.3.2 后端技术栈
- **Python + FastAPI**：轻量级、高性能、自动API文档
- **Pydantic**：数据验证和序列化

#### 5.3.3 数据库
- **开发环境**：SQLite
- **生产环境**：PostgreSQL

#### 5.3.4 部署
- **开发环境**：Vite开发服务器 + FastAPI开发服务器
- **生产环境**：静态文件部署 + FastAPI + Uvicorn + Docker容器化

### 5.4 接口设计（MVP）

- 词根（Root）
  - 增删改查：创建/更新/删除/查询词根及详情、列表（含筛选、排序）
  - 别名映射（P0“软合并”）：同义词标记为主词根别名；生成与搜索统一指向主词根
  - 引用预检查：重命名/停用/删除前返回受影响字段/模型清单

- 字段（Field）
  - 创建（强制词根组合）：仅允许从词根组合生成；缺词根时引导先创建
  - 查重校验：字段名全局唯一/命名合法校验；冲突返回替代建议
  - 查询/分页：按名称、含义、状态、类型过滤；分页、排序
  - 修改状态：active/deprecated 切换；记录变更历史

- 模型（Model）
  - 增删改查：创建/更新/删除/查询模型
  - 字段绑定/解绑：添加/移除字段，维护顺序、必填、默认值
  - 导出：导出 SQL、导出 Excel（建议放 P1）

- 统一响应结构
  - 成功：{ code: 0, data, message: "" }
  - 失败：{ code: 非0, error: { type, message, details } }
  - 分页：{ list, total, page, pageSize }

- 分页参数
  - 请求：page（默认1）、pageSize（默认20，最大100）、sortBy、order、filters（可选）

- 错误码与冲突提示
  - 400_INVALID_PARAM：参数非法（含命名不合规）
  - 409_CONFLICT_ROOT_EXISTS：词根/别名已存在
  - 409_CONFLICT_FIELD_EXISTS：字段名重复（返回建议名）
  - 422_UNPROCESSABLE_REFERENCE：存在引用不允许删除（附影响清单）
  - 500_INTERNAL_ERROR：服务器错误

- 极简路由清单（名称 + 方法）
  - 词根 Root
    - GET /api/roots
    - POST /api/roots
    - GET /api/roots/{id}
    - PUT /api/roots/{id}
    - DELETE /api/roots/{id}
    - POST /api/roots/{id}/aliases            # 别名映射（P0）
    - GET /api/roots/{id}/impact              # 引用预检查
  - 字段 Field
    - GET /api/fields
    - POST /api/fields                        # 强制词根组合创建
    - GET /api/fields/{id}
    - PUT /api/fields/{id}
    - PATCH /api/fields/{id}/status           # 状态切换
    - GET /api/fields/check-unique            # 查重校验（name 参数）
  - 模型 Model
    - GET /api/models
    - POST /api/models
    - GET /api/models/{id}
    - PUT /api/models/{id}
    - DELETE /api/models/{id}
    - POST /api/models/{id}/fields            # 绑定字段
    - DELETE /api/models/{id}/fields/{fieldId}# 解绑字段
    - GET /api/models/{id}/export/sql         # 导出SQL（P1）
    - GET /api/models/{id}/export/excel       # 导出Excel（P1）
